<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3Då±•å… - 3Dç¤¾äº¤å¹³å°</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        header {
            background-color: #2c3e50;
            color: white;
            padding: 1rem;
            text-align: center;
        }
        
        nav ul {
            list-style-type: none;
            padding: 0;
            display: flex;
            justify-content: center;
        }
        
        nav ul li {
            margin: 0 1rem;
        }
        
        nav ul li a {
            color: white;
            text-decoration: none;
        }
        
        main {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }
        
        #model-container {
            width: 800px;
            height: 500px;
            background-color: #eee;
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
        }
        
        .model-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .model-controls button {
            padding: 0.5rem 1rem;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .model-info {
            max-width: 800px;
            background-color: white;
            padding: 1rem;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .social-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .social-actions button {
            padding: 0.5rem 1rem;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }
        
        #model-upload {
            display: none;
        }
        
        .upload-btn {
            padding: 0.5rem 1rem;
            background-color: #27ae60;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .model-selector {
            margin-bottom: 1rem;
        }
        
        .model-selector select {
            padding: 0.5rem;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <header>
        <h1>3Då±•å…</h1>
        <nav>
            <ul>
                <li><a href="index.html">é¦–é¡µ</a></li>
                <li><a href="gallery.html">3Då±•å…</a></li>
                <li><a href="social.html">ç¤¾äº¤åœˆ</a></li>
            </ul>
        </nav>
    </header>
    
    <main>
        <div class="model-selector">
            <select id="model-select">
                <option value="">é€‰æ‹©æ¨¡å‹...</option>
                <option value="models/åŸºåœ°.obj">åŸºåœ°</option>
                <option value="models/åŸºåœ°2.obj">åŸºåœ°2</option>
                <option value="models/ä»“å‚¨å™¨.obj">ä»“å‚¨å™¨</option>
                <option value="models/å¤§ç‚®.obj">å¤§ç‚®</option>
            </select>
        </div>
        
        <div id="model-container"></div>
        <div class="model-controls">
            <button id="rotate-btn">æ—‹è½¬</button>
            <button id="zoom-in-btn">æ”¾å¤§</button>
            <button id="zoom-out-btn">ç¼©å°</button>
            <label for="model-upload" class="upload-btn">ä¸Šä¼ OBJæ¨¡å‹</label>
            <input type="file" id="model-upload" accept=".obj,.mtl">
        </div>
        
        <div class="model-info">
            <h2 id="model-title">3Dæ¨¡å‹å±•ç¤º</h2>
            <p id="model-description">è¯·ä»ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©æˆ–ä¸Šä¼ æ‚¨çš„OBJæ ¼å¼3Dæ¨¡å‹æ–‡ä»¶</p>
            <div class="social-actions">
                <button class="like-btn">â¤ï¸ ç‚¹èµ</button>
                <button class="comment-btn">ğŸ’¬ è¯„è®º</button>
                <button class="share-btn">â†—ï¸ åˆ†äº«</button>
            </div>
        </div>
    </main>
    
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/OBJLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <script>
        // åˆå§‹åŒ–Three.jsåœºæ™¯
        let scene, camera, renderer, controls, model;
        
        function init() {
            // åˆ›å»ºåœºæ™¯
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf0f0f0);
            
            // åˆ›å»ºç›¸æœº
            camera = new THREE.PerspectiveCamera(75, 800 / 500, 0.1, 1000);
            camera.position.z = 5;
            
            // åˆ›å»ºæ¸²æŸ“å™¨
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(800, 500);
            document.getElementById('model-container').appendChild(renderer.domElement);
            
            // æ·»åŠ å…‰æº
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(1, 1, 1).normalize();
            scene.add(directionalLight);
            
            // æ·»åŠ åæ ‡è½´è¾…åŠ©
            const axesHelper = new THREE.AxesHelper(5);
            scene.add(axesHelper);
            
            // æ·»åŠ è½¨é“æ§åˆ¶å™¨
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.target.set(0, 0, 0);
            
            // æ·»åŠ ç½‘æ ¼åœ°é¢
            const gridHelper = new THREE.GridHelper(10, 10);
            scene.add(gridHelper);
            
            // è®¾ç½®æŒ‰é’®äº‹ä»¶
            setupControls();
            
            // å¼€å§‹åŠ¨ç”»å¾ªç¯
            animate();
        }
        
        function setupControls() {
            // æ¨¡å‹é€‰æ‹©å™¨
            document.getElementById('model-select').addEventListener('change', function(e) {
                const modelPath = e.target.value;
                if (modelPath) {
                    loadModel(modelPath);
                    
                    // æ›´æ–°æ¨¡å‹ä¿¡æ¯
                    const modelName = modelPath.split('/').pop().replace('.obj', '');
                    document.getElementById('model-title').textContent = modelName;
                    document.getElementById('model-description').textContent = `å·²åŠ è½½æ¨¡å‹: ${modelName}`;
                }
            });
            
            // æ—‹è½¬æŒ‰é’®
            document.getElementById('rotate-btn').addEventListener('click', function() {
                controls.autoRotate = !controls.autoRotate;
                this.textContent = controls.autoRotate ? "åœæ­¢æ—‹è½¬" : "æ—‹è½¬";
            });
            
            // æ”¾å¤§æŒ‰é’®
            document.getElementById('zoom-in-btn').addEventListener('click', function() {
                camera.fov -= 5;
                camera.updateProjectionMatrix();
            });
            
            // ç¼©å°æŒ‰é’®
            document.getElementById('zoom-out-btn').addEventListener('click', function() {
                camera.fov += 5;
                camera.updateProjectionMatrix();
            });
            
            // æ–‡ä»¶ä¸Šä¼ 
            document.getElementById('model-upload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    loadModel(event.target.result);
                };
                reader.readAsDataURL(file);
                
                // æ›´æ–°æ¨¡å‹ä¿¡æ¯
                document.getElementById('model-title').textContent = file.name.replace('.obj', '');
                document.getElementById('model-description').textContent = `å·²åŠ è½½æ¨¡å‹: ${file.name}`;
            });
        }
        
        function loadModel(url) {
            if (model) {
                scene.remove(model);
            }
            
            const loader = new THREE.OBJLoader();
            
            loader.load(
                url,
                function(object) {
                    model = object;
                    
                    // è®¡ç®—æ¨¡å‹çš„åŒ…å›´ç›’
                    const box = new THREE.Box3().setFromObject(model);
                    const size = box.getSize(new THREE.Vector3());
                    const center = box.getCenter(new THREE.Vector3());
                    
                    // ç§»åŠ¨æ¨¡å‹ä½¿å…¶åŒ…å›´ç›’ä¸­å¿ƒä¸åœºæ™¯ä¸­å¿ƒå¯¹é½
                    model.position.x = -center.x;
                    model.position.y = -center.y;
                    model.position.z = -center.z;
                    
                    // è‡ªåŠ¨ç¼©æ”¾ä»¥é€‚åº”è§†å›¾
                    const maxDim = Math.max(size.x, size.y, size.z);
                    const scale = 1.5 / maxDim; // è°ƒæ•´ç¼©æ”¾æ¯”ä¾‹ä»¥é€‚åº”ç›¸æœºè§†å›¾
                    model.scale.set(scale, scale, scale);
                    
                    // æ›´æ–°ç›¸æœºä½ç½®
                    const newCameraZ = maxDim * 2;
                    camera.position.set(0, 0, newCameraZ);
                    camera.lookAt(0, 0, 0);
                    controls.target.set(0, 0, 0);
                    controls.update();
                    
                    // é‡ç½®æ§åˆ¶å™¨
                    controls.reset();
                    
                    // æ·»åŠ åˆ°åœºæ™¯
                    scene.add(model);
                },
                function(xhr) {
                    console.log((xhr.loaded / xhr.total * 100) + '% loaded');
                },
                function(error) {
                    console.error('An error happened', error);
                    document.getElementById('model-description').textContent = 'æ¨¡å‹åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼';
                }
            );
        }
        
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        
        // åˆå§‹åŒ–åœºæ™¯
        window.onload = init;
    </script>
</body>
</html>
